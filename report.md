# 气象站异常检测设计报告

---

**2022年《数字信号处理》课程大作业**

---

*无03 唐昌礼 2020010694*

---

## 一、问题设定

给出了 2015 年 3 月共 31 天的分布在全美 50 个州、共 150 个气象站的日平均气温测量数据，以及气象站的地理位置（经、纬度）。假设某天有 1 个气象站传感器异常（记录的平均气温比真实值升高了若干度）。设计算法，以尽可能高的成功率检测出存在异常的气象站编号。

## 二、参考指标

算法的性能用平均成功率评价。即遍历所有 31 天、每天 150 个气象站，分别假设该气象站出错（在数据上人为地增加或减少一定的数值，如 20°），采用同样的算法对修改后的数据进行检测。若在每次实验中，算法只给出了 1 个出错气象站位置，并该位置正确，则计成功 1 次。那么成功率等于：
$$
平均成功率=\frac{成功次数}{实验次数}=\frac{成功次数}{4650}
$$

## 三、问题分析

考虑到检测算法是针对一定区域内的气象站在一定时间内气温数据进行检测，因此我认为可以从两个角度来考虑该问题。

1. 空间关系：不同气象站的地理位置存在关系，因此可以利用气象站之间的空间坐标关系对气温进行分析，找到气温数据错误的气象站。
2. 时间关系：同一气象站在一定时间范围内的日均气温相差不大，可以利用这一点来识别气温数据出错的气象站。

值得注意的是，由于该算法应保持因果性，因此在考虑时间关系时，不应利用未来的数据进行分析，否则算法不能真正应用到实际中。

## 四、算法设计

算法设计分为两层，一是针对空间关系的，二是根据时间关系的，并最后可以利用两个关系进行合并，得到更好的效果。

### 4.1 空间算法

空间算法是利用不同气象站的空间关系进行检测。我用图模型建模气象站之间的空间关系。将不同气象站定义为图的结点，结点的值为对应气象站的温度，图视为全连通图，边长为结点与结点间的“距离”。考虑到温度主要与纬度有关，我将“距离”定义为气象站间的纬度差。

因为纬度相近的地区气温接近，因此气温随纬度的变化应是连续的、平滑的，而气温检测出错会破坏这种平滑性。对于输入的图，我希望通过某种方式，衡量出结点 $i$ 处温度对纬度的平滑性，从而可以遍历所有结点，得到每个结点处的平滑性。平滑性最弱的结点将很有可能为数据错误的结点。

我使用文献 [1] 中定义的**局部变异量 (local variation)**衡量每个结点的平滑性。局部变异越大，该结点处平滑性越差。结点 $i$ 的局部变异量的定义为
$$
||\grad_if||_2=\sum_{j\in N_i}W_{ij}(f(j)-f(i))^2
$$
其中 $N_i=\{i|i\neq j\}$，$W_{ij}$ 为窗函数，$f$ 为结点函数，在本任务中为结点对应的温度函数。

对于输入的一天的所有气象站的气温数据 $t$ ，该算法计算每个气象站结点的局部变异，取局部变异最大的结点为出错结点，即：
$$
pred_{space} = argmax\{||\grad_i \mathbf{\vec{f}}||\}
$$

### 4.2 时间算法

对于同一气象站，一定时间内气温接近。在考虑算法因果性的情况下，可以用气象站当天的气象数据与过去若干天的气象数据进行对比，来判断气象站检测气温是否出错。

在这里，我假设过去 $N$ 天的数据是准确无误的。对于第 $i$ 个结点，将当天的气温 $t$ 与过去 $N$ 天的气温平均值作差，计算差距 $\delta_i$。

遍历所有结点，计算温度差距 $\delta$，取 $\delta$ 最大的结点为预测的气温错误结点，即：
$$
pred_{time}=argmax\{\mathbf{\vec{\delta}\}}
$$

### 4.3 综合算法

综合利用空间关系和时间关系设计算法。最终设计算法在下文的“融合算法”部分详细阐述。

## 五、实验结果

在数据上人为地增加 20°进行实验。

空间算法方面，设置窗函数为高斯窗，标准差 $\sigma$ 为超参数，不同超参数下算法结果如下

| $\sigma$ | acc(%) |
| -------- | ------ |
| 2        | 38.99  |
| 2.5      | 40.25  |
| 3        | 40.41  |
| 3.5      | 40.41  |
| 4        | 40.02  |

时间算法方面，结果普遍较差，准确率大约低于10%。

## 六、融合算法

时间算法尽管准确率低，但并非一无是处。我发现在一些极端的数据形式下，时间算法能够判断正确空间算法判断错误的地方。因此，我设计如下算法将时间算法与空间算法融合。

对于时间算法中计算出的所有结点的最大的 $\delta$，设置阈值 $threhold$，当 $\delta>threhold$ 时，预测结果取时间算法的预测值；否则取空间算法的预测值。对于第 0 天，直接使用空间算法进行预测。

这样设计之后，在一些极端的数据形式下，算法能够更加鲁棒。在经过基本的参数选择后，我将超参数设置为：

空间部分：标准差 $\sigma=3$

时间部分：取当天的前 7 天的平均温度，$threhold$ 设置为 50°

在数据上人为地增加 20°进行实验，**准确率为：$41.78\%$**

## 七、灵敏度测试

在数据上人为地增加 10°、20°、30° 进行测试，参数采用上述参数，并与只使用空间算法进行对比，结果如下

| $\Delta t$（°） | time+space acc (%) | only space acc(%) |
| --------------- | ------------------ | ----------------- |
| 10              | 9.76               | 9.66              |
| 20              | 41.78              | 40.41             |
| 30              | 76.99              | 73.48             |
| 40              | 92.15              | 89.23             |

可以看到，随着温度的误差增大，算法准确率显著升高，且空间与时间的融合算法始终略微优于空间算法，证明了融合算法的有效性。

## 八、文件清单

`main.py`：主程序

`report.pdf`：实验报告

`data.mat`：实验数据

使用方式：若要复现报告中针对人为增加 20° 的数据，命令行输入：

~~~bash
python3 ./main.py --sigma 3 --front 7 --threhold 50 --use_time_info --delta_t 20
~~~

最终准确率应为：0.4178494623655914

## 参考文献

[1] Shuman D, Narang S K, Frossard P, et al. The emerging field of signal processing on graphs: Extending high-dimensional data analysis to networks and other irregular domains[J]. Signal Processing Magazine, IEEE, 2013, 30(3): 83-98.